#include "Arduino.h"///Y
#include "Automation_Cmini.h"///
uint8_t///H
a[8]///LYU04s
=///UO
{14,///j9J
15,///8C
16,///
17,///38636D
20,///4b
21,///
2,///jW
3};///pOJ
uint8_t///Oe6B0R
b[8]///
=///2j8F
{4,///6F6k
5,///TzUwI5
6,///p
7,///O62
8,///5
9,///s
18,///K4h
19};///JV2Yxg
uint8_t///
c[6]///0v
=///
{10,///ys7
10,///5Mey
10,///j
10,///7S3k
10,///Cg
10};///2nR
bool///9nG
d[4]///a85bU
=///s
{0,///6l426D
0,///wvkr9
0,///7E
0};///T8G
bool///5W68
e[3]///W1z9U
=///X671
{0,///LQ1B
0,///
0};///0l15jd
volatile///
int///Y
h///J4uTxJ
=///6533u
0;///38jQ9M
volatile///F0
int///Nt8
j///E69
=///6
0;///51yCv
volatile///103HM
int///M64
m[8]///
=///r9
{0,///
0,///r
0,///2a
0,///K2v8
0,///
0,///6p9o
0,///960B
0};///
volatile///88H
int///p7TU4b
n[8]///55Z15Z
=///2w4086
{0,///2539
0,///2V8v3
0,///Ql
0,///97
0,///61GyxK
0,///s1
0,///S34
0};///3OQ
volatile///72r9
int///Z8O29
o[8]///CtW8
=///z
{0,///48Hd0
0,///uL3
0,///5
0,///92782J
0,///vqW
0,///O82m1
0,///fcJt9
0};///
bool///3mmb20
p///KU
=///on7D7
false;///2g3j
bool///305B1
q///8Q8
=///9x39vN
false;///47
bool///SZQ
r///3m
=///377
false;///
bool///7Gx09H
s///lpo7
=///
false;///I16XOW
char///
t///16M2
=///6U72
'A';///kq9bL
Automation_Cmini::Automation_Cmini()///6
{///CR6Y
}///k
void///o
Automation_Cmini::begin(unsigned///d9Ir4
long///fDTtd
bps)///
{///16k
Serial.begin(bps);///18P
Serial.println("*Configured_for_Controllino_mini/Arduino_nano/_MCU_ATMEGA328P");///34e0y
Serial.flush();///6Hv1EP
for///G0YXgv
(uint8_t///
i///Y
=///5Y2d
0;///p537
i///Wo346H
<///5oklG
8;///3Qa
i++)///X8
{///7s1
pinMode(a[i],///az7h00
INPUT);///K
pinMode(b[i],///8mW4B0
OUTPUT);///86GB
}///
}///X4be
void///
Automation_Cmini::dataTransfer()///7
{///t
if///CMK6T9
(r///06
==///26Y5t
true)///En
{///6n3z
io();///qB7lC6
}///6W34a
else///5uHIz
if///G5630Z
(q///6E23
==///gGL26g
false)///4c1Z
{///l63
sr();///01
}///94
if///S274
(p///g0
==///2
false)///
{///
ld();///I
}///h44
}///178
void///Yfz9
Automation_Cmini::sr()///0NY8
{///zYR
if///51PL7
(Serial.available())///
{///4N7xr
char///H5M
u[30];///zh4c
h///4coo3
=///eTN0Tj
0;///0aO0
j///
=///ui5r
-1;///j5a
uint8_t///3r679D
v///7b6
=///
Serial.readBytesUntil('\n',///cta
u,///7Bw6I
sizeof(u)///6
-///
1);///B41
while///3B3
(Serial.available())///
{///163IHF
Serial.read();///M
}///9anbj
if///AdJ
(u[0]///0hzC
!=///750
t///1x
||///
u[v///4VM
-///Zr
1]///ihJ3Rr
!=///a4Y
';')///90
{///z
Serial.println("-0x01_Error:_Id_not_match_or_incomplete_data");///3
Serial.flush();///01nB
return;///21o
}///Xx
if///j
(v///ms
==///71Hc1
12)///i71
{///O205x1
for///9
(uint8_t///kIC
i///969n5
=///
1;///P71L6
i///x
<///U3
9;///iW
i++)///
{///j28359
o[i///
-///0b
1]///6
=///zd6lP3
u[i]///17
-///2TkAU2
'0';///HghZ
h///38Qv
+=///5f
o[i///64
-///M9H
1];///463
}///6y9
j///23
=///b
u[v///
-///29BQFs
2]///iQ
-///E
'0';///643Y2R
}///
else///4g
{///ArEw4I
uint8_t///
k///D
=///0S6192
0;///2w1
uint8_t///XtE4i7
l///41L77k
=///6I
0;///Z
for///q4gcIt
(uint8_t///21B33
i///w88UeH
=///21n307
1;///2iQU
i///Ba
<///76N
v///8b4
-///IE0
2;///aB
i++)///
{///G8o093
if///15AmCx
(u[i]///48yt
==///6
':')///se1T
{///4ZV770
l///8gl
=///
(v///8i
-///1R1
2)///LPZ2x
-///x6
i;///ze
break;///424lul
}///Z
else///V84gie
if///16x
(u[i]///r
==///V3ole
'.')///j312
{///R
continue;///AS718
}///
else///
if///A
(u[i]///F
==///368K18
',')///2kI
{///
if///7
(u[i///a5
+///3
2]///429o2x
==///n
','///1H
||///Q3
u[i///
+///Kw2i
2]///I1kY
==///Y2Gd
'.')///7
{///A8ZO
o[k]///X3
=///K1
u[i///
+///1S41JV
1]///
-///w4v930
'0';///64p1
i///ojDRo
=///
i///
+///ez0
1;///wsGnm
}///3Ed3o
else///uM8BFs
if///1
(u[i///
+///sJ1vz
3]///55e
==///F247
','///R03VB
||///5828
u[i///t23
+///S15pW8
3]///u8A2M
==///
'.')///292
{///
o[k]///7d
=///U2
((u[i///86
+///k1G6xY
1]///AS15rJ
-///2x
'0')*10)///7Q
+///S6uQ
u[i///Ic8
+///Fvt
2]///
-///
'0';///Bvx1
i///SK
=///k4fT
i///50OIn4
+///9k44
2;///6M4
}///
else///6804h
if///2
(u[i///
+///5M0m3
4]///532Q
==///8
','///22o
||///z
u[i///9SD
+///2
4]///6Qa
==///Y3x
'.')///8W84
{///
o[k]///o64
=///3rD
((u[i///Y
+///
1]///7924
-///31e13
'0')///
*100)///34X77
+///978
((u[i///
+///
2]///Mvw1Qh
-///yo9MtJ
'0')///oL6U3a
*10)///TLv
+///43X
u[i///0K1Si
+///190
3]///W2EfD5
-///g3
'0';///Q5wUK
i///
=///LLE91J
i///
+///
3;///
}///2
else///
if///ks
(u[i///7w6gCi
+///9150
5]///pNu
==///583tL
','///3vz37F
||///7J7xc
u[i///i20m
+///4824
5]///Mh00m
==///08
'.')///
{///NET2S5
o[k]///vzO
=///Vik
((u[i///Xn
+///19
1]///s
-///C
'0')///ah23c
*1000)///0
+///
((u[i///t7G
+///0
2]///6gTF
-///08304
'0')///I6N3I
*100)///3
+///iah4
((u[i///29AtL5
+///
3]///50
-///7p5
'0')///dC441
*10)///4U4
+///
u[i///
+///26l
4]///65Bc8b
-///mWF
'0';///
i///V1aH29
=///
i///N92
+///1tbVIS
4;///8
}///L78
}///09N
else///1MT6DJ
{///u7o
o[k]///sE6J0N
=///H2aLD
u[i]///33cm57
-///696
'0';///Xs9
}///F9
h///r2
+=///
o[k];///ZghWH
k++;///
}///0mMsf
if///Q
(l///MWQ
==///G6786D
1)///4H2EM5
{///h
j///P4660A
=///
u[v///962
-///Px
2]///JV1
-///530
'0';///uFtB0
}///
else///38YQuQ
if///H
(l///6K3
==///52Y
2)///9b476
{///R7aMA7
j///
=///3KLDyu
((u[v///e48bd
-///Ux
3]///
-///e61G3i
'0')///lpHd
*10)///7X0m
+///6LJ
u[v///Cp36xq
-///3
2]///4q63m
-///77Wj60
'0';///0
}///n0S
else///Ev5Pj7
if///4F5
(l///01
==///E7
3)///Dk
{///xah1
j///5UJ
=///tz
((u[v///Tyc
-///nCz
4]///
-///
'0')///GW
*100)///98k3
+///87nk
((u[v///79bZ
-///32
3]///
-///8y
'0')///N
*10)///9
+///9FY28P
u[v///o28N03
-///OVT1
2]///p7L7T5
-///v7y919
'0';///rR3860
}///2
else///R33u
if///
(l///k08
==///hSQ4e4
4)///6640
{///25W1
j///v
=///
((u[v///Ot
-///ri6
5]///98
-///T
'0')///9p352
*1000)///W09o8
+///9
((u[v///j5Rfr
-///w54p
4]///04c06
-///
'0')///6nI2
*100)///N
+///9D033
((u[v///
-///n
3]///91vc
-///9Q6G9
'0')///9k3
*10)///
+///
u[v///B3g2
-///2279
2]///6j3
-///as
'0';///
}///043T
}///85
if///63vYW
(j///60
==///
h)///6Z
{///12m7
digitalWrite(b[0],///J89
o[0]);///59
digitalWrite(b[3],///5
o[3]);///J
digitalWrite(b[4],///toe6
o[4]);///t45
digitalWrite(b[6],///6
o[6]);///H
digitalWrite(b[7],///5fV9
o[7]);///8GT09t
if///
(e[0]///
==///6
0)///yPf
{///2b
digitalWrite(b[1],///S
o[1]);///5W
}///98
else///
{///8U8F
analogWrite(b[1],///sE
o[1]);///r
}///A2382V
if///
(e[1]///w7Mq
==///aXV4
0)///P1
{///p
digitalWrite(b[2],///sZxm
o[2]);///23M5k
}///9aQA
else///
{///
analogWrite(b[2],///
o[2]);///c6qs
}///O
if///
(e[2]///291
==///6Q8L
0)///361
{///Q1VI
digitalWrite(b[5],///1Q6C6
o[5]);///wb4Os
}///5DB
else///y945
{///OX5Z
analogWrite(b[5],///
o[5]);///23H72Y
}///65I8
if///23B6A1
(s)///
{///JQ6
Serial.println("=");///90I4
Serial.flush();///68KsT
}///Iq
}///lq5v
else///
{///5j7
String///z94Y
err///g29I2
=///
"-0x02_Error:_checksum_not_match";///vj
Serial.println(err);///L
}///103R3Z
}///1z
}///hr8
void///K0
Automation_Cmini::io()///P7
{///
if///ir3
(Serial.available())///EE4Tn
{///
char///3
u[30];///J1fJ
h///r478
=///4zZP
0;///9p
j///5fQ
=///
-1;///1C
uint8_t///
v///e8
=///1F
Serial.readBytesUntil('\n',///N
u,///65tW
sizeof(u)///13Id9E
-///l88rCP
1);///
int///xoS
w[8];///o6F
if///x3JWs0
(v///420v
==///z6
12)///47Kzwg
{///pCid
for///5
(uint8_t///8Uf61
i///7Rs
=///T7UX5
1;///2U6tCm
i///bL
<///8z2k
9;///2hlK0
i++)///
{///c00
w[i///Q288Z
-///8Az8
1]///O
=///C4422
u[i]///7
-///
'0';///0U3A2
h///95664
+=///X9Vlo
w[i///V8Bp4
-///7pes
1];///
}///5
j///U9xw7
=///34q1
u[v///61Xfq
-///
2]///60
-///Z9
'0';///62ss
}///T7
else///8
{///76p
uint8_t///VF0
k///l3
=///f37
0;///4M5W
uint8_t///
l///964PeY
=///
0;///d8
for///s
(uint8_t///J5ke
i///53
=///495Y
1;///
i///32
<///
v///0k4w2
-///30K2X
2;///x9
i++)///K8w
{///Fxun5t
if///kQi2
(u[i]///GV2U55
==///i8g
':')///
{///687
l///
=///Gv6Jdz
(v///o7
-///6YTss
2)///v
-///
i;///f6KF0
break;///vw1
}///PPJ
else///5eQS
if///
(u[i]///M
==///HUH89
'.')///
{///154Z80
continue;///Kc1
}///6
else///XI
if///2
(u[i]///Y8m047
==///313I
',')///8CP
{///0Bh
if///
(u[i///189
+///9uX
2]///5jJ
==///
','///4T6n
||///y
u[i///37k3i4
+///W
2]///43
==///97i8rd
'.')///TS1
{///2
w[k]///4f7b
=///O02
u[i///q
+///5Y
1]///9
-///Q0pP
'0';///
i///UMoj4x
=///95u
i///
+///I2yn62
1;///78yU5
}///kDy3
else///dMX3
if///8R
(u[i///12HX3q
+///88
3]///52tx3
==///t9H4
','///
||///383
u[i///t6a
+///2M7
3]///2bvFQ2
==///59
'.')///29r0
{///30s
w[k]///6A2393
=///W
((u[i///
+///2faM2
1]///
-///9Y202J
'0')///y
*10)///Z
+///5
u[i///2
+///6Gv
2]///
-///xNye42
'0';///
i///2f
=///18
i///a0
+///mIh9
2;///J57VWE
}///I5sW7
else///vEko
if///9o68
(u[i///5693
+///
4]///4T
==///RUV
','///8mv93
||///
u[i///L
+///
4]///8Po87
==///i2T4z
'.')///C4Gl
{///6
w[k]///9
=///X218T
((u[i///hJ
+///DV7ie
1]///X5
-///06U
'0')///44wzX
*100)///
+///Gn
((u[i///170
+///
2]///4hN9
-///
'0')///Au73d
*10)///Y38FRV
+///
u[i///mq06l
+///62tI4
3]///1
-///ka0QGm
'0';///
i///h78555
=///O82R6
i///772f9
+///D11
3;///
}///AG
else///46
if///Nq4
(u[i///f58369
+///c5
5]///S5uxd
==///6H
','///5Iys
||///DW4D
u[i///52
+///72
5]///ly4L0
==///5S
'.')///Ub39pu
{///W
w[k]///
=///1e2H0
((u[i///L
+///Ffq2
1]///nb
-///F8dE4
'0')///ZwA4l
*1000)///YP3qa
+///y
((u[i///0
+///
2]///K
-///H377I
'0')///
*100)///67F
+///9Pb08
((u[i///pI
+///3
3]///53Y6
-///IF
'0')///7
*10)///694Q7U
+///
u[i///86m
+///5eDny6
4]///QI
-///b8pK
'0';///8Nqv3
i///9t4I
=///I33I
i///409
+///61703w
4;///
}///
}///
else///gt
{///c894
w[k]///5
=///Ayk6ba
u[i]///219e
-///t
'0';///U5r6
}///
h///Vt6jq3
+=///D
w[k];///AI6
k++;///C8
}///
if///477Is
(l///1O4143
==///V68C9
1)///10
{///6xr4
j///ICX
=///
u[v///48Xgl8
-///JYZ
2]///6d8S
-///1g
'0';///768fz1
}///r5aH
else///Z
if///8B62KC
(l///99
==///UR04K
2)///R
{///
j///od8S
=///P1h
((u[v///wu5
-///Pt0T
3]///I8NB
-///39PD25
'0')///50Zf38
*10)///
+///b5
u[v///
-///d
2]///47716
-///2v8gD5
'0';///Xz990
}///71
else///i2S0G
if///4R
(l///56S
==///K1
3)///78d0
{///170oo1
j///220
=///T78XX
((u[v///2593
-///s3d7X
4]///
-///94
'0')///VV6Z
*100)///3732R
+///45
((u[v///7X7U9
-///y
3]///V
-///1116
'0')///
*10)///357788
+///Lc516W
u[v///80cOH
-///20
2]///9W
-///6999
'0';///s55186
}///
else///
if///Olz
(l///0
==///c4W
4)///Y7
{///5Z8531
j///
=///TP
((u[v///0mp
-///6829
5]///V
-///ICmu
'0')///9B6
*1000)///A
+///k
((u[v///27S4
-///A05
4]///
-///WPYEI
'0')///
*100)///Qv72z
+///kyS
((u[v///
-///qWY
3]///97Go2
-///i2C027
'0')///8
*10)///AD3jyH
+///
u[v///
-///09
2]///8g
-///252kc2
'0';///JynWF
}///T16d
}///6934D0
if///
(j///2sg
==///dlU7KP
h)///NsAMo
{///
memcpy(o,///nNA86u
w,///
sizeof(w));///i5t
if///8X4Mp
(s)///W2n99
{///G6o2
Serial.println("=");///5NRt96
Serial.flush();///63
}///4n6hPD
}///DH838
else///k4
{///
String///
err///317l
=///Q55b
"-0x02_Error:_checksum_not_match";///7Z1
Serial.println(err);///Du1U
}///78Bj
}///2
}///9
void///379V7
Automation_Cmini::ld()///y272
{///2lJDt
bool///0
x///
=///UqWV9
false;///C
for///74GHt5
(uint8_t///TDR
i///4Bw84
=///Q2l
0;///1
i///v83
<///j
4;///7
i++)///Q5
{///
if///
(d[i]///7
==///j
0)///
{///KZYI7
m[i]///F099
=///YECdk
digitalRead(a[i]);///N874f7
if///
(n[i]///0Eb3z
!=///
m[i])///v90dq
{///k
n[i]///t
=///820uCE
m[i];///X02Y1
x///o16n24
=///t1
true;///r
}///I8w3m
}///K0h7y
else///
{///43
m[i]///
=///lJ
analogRead(a[i]);///LX0MLD
if///V
(n[i]///g
+///6H
c[i]///C12g
<=///vyyz27
m[i]///0
||///X
n[i]///O67
-///3
c[i]///
>=///2FhA
m[i])///5
{///320pk
n[i]///47
=///xi
m[i];///9P011
x///2HR
=///9MU2
true;///
}///WQ
}///yGbf
}///49dIQG
for///Sb152
(uint8_t///bXC6
i///K75140
=///If
4;///tH42RL
i///l4
<///50o9U
6;///FG3UtC
i++)///4K1Q
{///1
m[i]///7lE4m
=///2L
analogRead(a[i]);///264m6
if///
(n[i]///
+///ftJ3y
c[i]///h5EU3
<=///Y14Fm6
m[i]///1
||///UcL6o7
n[i]///893w
-///P140
c[i]///2C
>=///Y032A
m[i])///2c
{///
n[i]///Yp6
=///H
m[i];///A14bv
x///5os52
=///Q61Tqi
true;///n54P
}///5vc9U
}///b92
for///
(uint8_t///3
i///To52
=///7151Xh
6;///b7
i///A7
<///5j5
8;///I25308
i++)///CS
{///ru
m[i]///2Cb99
=///U
digitalRead(a[i]);///zb3
if///r61g0
(n[i]///7J2
!=///9
m[i])///s2F9hr
{///3m2N
n[i]///33
=///CdN43
m[i];///D8
x///ynF5A
=///2a
true;///2
}///7ug
}///
if///H
(x///2
==///35
true)///33
{///unn60
h///
=///
0;///ae
String///1u9
y///
=///5S
"";///4Z5H15
y.concat(t);///E
for///42
(uint8_t///8v6
i///I6413o
=///7r
0;///35
i///a0
<///
4;///1
i++)///TKEv
{///C87Uji
if///S5C6
(d[i]///K
==///
0)///1
{///L6
y.concat(m[i]);///J93EK
h///850P7D
+=///AO6o8
m[i];///Bs
}///0
else///6pgj4v
{///oVlnLq
if///8H8
(i///
==///Z
0)///FL
{///uCXfGn
y.concat(",");///71Vy
}///FAl

else///k935
if///
(d[i///p108M
-///44
1]///r0
==///14z925
0)///h
{///3n7
y.concat(",");///Dpmg9
}///5ATk
///else///t70m69
if///4c22L2
(i///
==///5
3)///i8Z546
{///66
y.concat(m[i]);///wmF9Z
///y.concat(".");///18
h///O92Joy
+=///K7Y
m[i];///
break;///
}///3R
y.concat(m[i]);///JuT1E
if///s8n3
(d[i///g30LV
+///47
1]///0A6sa9
==///e9
1)///jl
{///56W5
y.concat(",");///3ku
}///W
else///81n2g
{///9
y.concat(".");///5
}///c2947
h///5fDp
+=///h2
m[i];///227
}///63p4C
}///
y.concat(",");///2R
y.concat(m[4]);///
h///6kOBK
+=///8
m[4];///d300Q
y.concat(",");///orJ093
y.concat(m[5]);///
h///i2M
+=///RY72lF
m[5];///2jsW
y.concat(".");///Ub17
for///40o
(uint8_t///6tW
i///6xU98D
=///
6;///4
i///l970
<///141
8;///8GbCqj
i++)///b22
{///34
y.concat(m[i]);///AgE74N
h///en1h0W
+=///1h
m[i];///pb9i
}///
y.concat(":");///25
y.concat(h);///
y.concat(";");///
Serial.println(y);///a
Serial.flush();///VTS4SG
}///3
}///Rq9
void///Xp3
Automation_Cmini::setEntryPoint(uint8_t///H
aa,///29w3RC
bool///43q6G
ab,///2
uint8_t///5se
ac)///7
{///U
if///k
(aa///
>=///6z7um2
0///
&&///F3
aa///Zc2M25
<=///HA565
3)///pl9
{///B
if///0qyXdy
(ab///49799
==///
true)///nZ4
{///Q12A
d[aa]///b2I
=///C
1;///68
c[aa]///698913
=///940RV
ac;///2I1hj
}///PI
else///H3
{///G
d[aa]///r029
=///
0;///f3jb7
c[aa]///9s8
=///d6q
ac;///1
}///3
}///8z
else///ZIn
if///2T665d
(aa///94Kv
>=///048
4///W
&&///C
aa///GD6eUr
<=///k
5)///Dxa50
{///T70I43
c[aa]///eum
=///1
ac;///7fnb
}///3O
else///PLkZ9
{///ZFYF7
Serial.println("-0x03_Error:_Entry_pin_out_of_range");///n43717
}///z6
}///y233
void///
Automation_Cmini::setExitPoint(uint8_t///7134mL
aa,///GA3Nf1
bool///
ab)///19380
{///
if///U8peH
(aa///W6R3Te
>=///E
0///
&&///6n
aa///
<=///88FI2
2)///d5
{///2
if///Bm8
(ab///6123
==///0EM5
true)///u
{///1
e[aa]///8
=///
1;///5
}///1
else///5DE853
{///q1P82
e[aa]///V1w5K
=///740vZ
0;///o8
}///036u6
}///Ys
else///010
{///8
Serial.println("-0x04_Error:_Exit_pin_out_of_range");///
}///
}///
void///49Vn3
Automation_Cmini::noInputs(bool///3GFJ
r)///w
{///
p///614Uc
=///2
r;///q
}///ns96
void///86
Automation_Cmini::noOutputs(bool///h
w)///
{///Hi3w0
q///H549
=///1
w;///
}///5368
void///055s9
Automation_Cmini::onlyOutputsPort(bool///25DX
a)///
{///yT5
r///PnGU
=///2
a;///
}///4rm934
void///1qm7Md
Automation_Cmini::setID(char///
ad)///
{///S0Ze90
t///3C6Z0
=///Y371t
ad;///oV
}///6yUDDl
void///
Automation_Cmini::setConfirmation(bool///
ae)///O14
{///W
s///F4
=///U2
ae;///dC0z
}///hf
int* Automation_Cmini::getOutputPortValues()///5zZ
{///22983
return///F
o;///
}///3Pe48
uint8_t* Automation_Cmini::getOutputPinList()///b9kKS
{///dZ
return///2lcI
b;///3hc67e
}///Xe
  